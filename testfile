// vars/getFoundationManifests.groovy

def call(String pcfFoundation) {
    // Load YAML from shared library resources
    // Updated path to reflect your folder structure
    def yamlText = libraryResource('pipeline-global-config/foundation-manifests.yml')
    def foundationManifests = readYaml text: yamlText

    // Get manifest(s) for the requested foundation
    def manifestList = foundationManifests[pcfFoundation]

    if (!manifestList) {
        error "❌ No manifest mapping found for PCF foundation: ${pcfFoundation}"
    }

    echo "✅ Resolved manifest(s) for ${pcfFoundation}: ${manifestList}"
    
    return manifestList
}



stage('validate: manifest') {
    logStage('validate-manifest')
    script {
        // Call shared library function to get manifest list
        def manifestList = getFoundationManifests(pcfFoundation)

        // Validate each manifest
        manifestList.each { manifestFile ->
            echo "🔍 Validating manifest: ${manifestFile}"
            if (fileExists(manifestFile)) {
                validateSplunkIndex(manifestFile, 'prod')
            } else {
                buildFailed("❌ No manifest file found: ${manifestFile}")
            }
        }
    }
}
